!function(e){function t(t){for(var s,l,i=t[0],c=t[1],o=t[2],d=0,h=[];d<i.length;d++)l=i[d],n[l]&&h.push(n[l][0]),n[l]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);for(m&&m(t);h.length;)h.shift()();return r.push.apply(r,o||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],s=!0,i=1;i<a.length;i++){var c=a[i];0!==n[c]&&(s=!1)}s&&(r.splice(t--,1),e=l(l.s=a[0]))}return e}var s={},n={1:0},r=[];function l(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=e,l.c=s,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},l.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var i=window.webpackJsonp=window.webpackJsonp||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var o=0;o<i.length;o++)t(i[o]);var m=c;r.push(["DT9B",0]),a()}({0:function(e,t){},DT9B:function(e,t,a){"use strict";a.r(t);var s=a("q1tI"),n=a.n(s),r=a("i8i4"),l=a.n(r),i=a("/MKj"),c=a("fvjX"),o=a("TdMD"),m=a.n(o),d=a("eO8H");const h=({path:e,children:t})=>n.a.createElement(d.c,{path:e,children:({match:a})=>n.a.createElement(d.b,{className:`navbar-item ${a?"is-active":""}`,to:e},t)});var p=Object(d.e)(Object(i.b)(e=>({user:e.user}))(class extends n.a.Component{render(){return n.a.createElement("nav",{className:"navbar is-link"},n.a.createElement("div",{className:"navbar-brand"},n.a.createElement(d.b,{className:"navbar-item has-text-weight-bold is-size-4",to:"/"},"Verbum")),n.a.createElement("div",{className:"navbar-menu"},n.a.createElement("div",{className:"navbar-start"},n.a.createElement(h,{path:"/dictionaries"},"Dictionaries"),n.a.createElement(h,{path:"/articles"},"Articles")),n.a.createElement("div",{className:"navbar-end"},n.a.createElement("div",{className:"navbar-item"},this.props.user.name))))}}));const u=(e,t="info")=>a=>{const s=Date.now();a({type:"MESSAGES/SHOW",message:{id:s,message:e,level:t}}),setTimeout(()=>{a({type:"MESSAGES/DISMISS",message:{id:s}})},5e3)};var E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};const f=e=>t=>!!t&&e(t),v=(e,{options:t,actionPrefix:a,errorMessagePrefix:s,successMessage:n})=>r=>(r({type:`${a}/PENDING`}),fetch(e,E({},t,{credentials:"include"})).then(e=>new Promise((t,a)=>{e.ok?e.json().then(e=>t(e)).catch(()=>t({data:{}})):e.text().then(t=>{a(new Error(t||e.statusText))})})).then(e=>(r(E({type:`${a}/FULFILLED`},e)),n&&r((e=>u(e,"success"))(n)),e)).catch(e=>(r({type:`${a}/REJECT`}),s&&r((e=>u(e,"danger"))(`${s}: ${e.message}`)),console.error(e),!1))),b=e=>{const t=new URLSearchParams,a=e._defaults||{};delete e._defaults;for(let s of Object.keys(e))s in a&&a[s]===e[s]||t.set(s,e[s]);let s=t.toString();return s.length>0&&(s=`?${s}`),s},g=()=>v("/admin/api/dictionaries",{actionPrefix:"DICTIONARIES/LIST/FETCH",errorMessagePrefix:"Failed to fetch Dictionaries list"}),S=()=>({type:"DICTIONARIES/LIST/LEAVE"}),D=({formData:e})=>v("/admin/api/dictionaries",{options:{method:"post",body:JSON.stringify(e)},actionPrefix:"DICTIONARIES/DICTIONARY/CREATE",errorMessagePrefix:"Failed to create the dictionary",successMessage:"Dictionary has been created successfully"});var I=Object(i.b)(e=>({data:e.dictionaries.list}),e=>Object(c.b)({fetchList:g,leaveList:S},e))(class extends n.a.Component{componentWillMount(){this.props.fetchList()}componentWillUnmount(){this.props.leaveList()}render(){const{url:e}=this.props.match;return n.a.createElement("div",null,n.a.createElement("div",{className:"level"},n.a.createElement("div",{className:"level-left"},n.a.createElement("h1",{className:"level-item title"},"Dictionaries")),n.a.createElement("div",{className:"level-right"},n.a.createElement("div",{className:"field is-grouped level-item"},n.a.createElement("p",{class:"control"},n.a.createElement(d.b,{to:`${e}/new`,className:"button is-link"},"New Dictionary"))))),n.a.createElement("hr",null),this.props.data&&n.a.createElement("table",{className:"table is-hoverable is-fullwidth"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Title"))),n.a.createElement("tbody",null,this.props.data.map(e=>n.a.createElement("tr",null,n.a.createElement("td",null,e.Title))))))}});class C extends n.a.Component{constructor(e){super(e),this.state=e.formData,this.handleInputChange=this.handleInputChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleInputChange(e){const t=e.target;let a="checkbox"===t.type?t.checked:t.value;const s=t.name;this.setState({[s]:a})}handleSubmit(e){e.preventDefault(),this.props.onSave({formData:this.state})}render(){return n.a.createElement("form",{onSubmit:this.handleSubmit},n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"Title"),n.a.createElement("div",{class:"control"},n.a.createElement("input",{className:"input",type:"text",name:"Title",value:this.state.Title,onChange:this.handleInputChange,required:!0}))),n.a.createElement("div",{className:"field is-grouped"},n.a.createElement("p",{class:"control"},n.a.createElement("button",{className:"button is-link",type:"submit"},"Save")),n.a.createElement("p",{class:"control"},n.a.createElement(d.b,{className:"button",to:this.props.onCancelRedirectTo},"Cancel"))))}}var T=Object(i.b)(e=>{},e=>Object(c.b)({createDictionary:D},e))(class extends n.a.Component{render(){return n.a.createElement("div",null,n.a.createElement("h1",{className:"title"},"Create New Dictionary"),n.a.createElement(C,{formData:{},onSave:e=>{this.props.createDictionary(e).then(f(e=>this.props.history.push("/dictionaries")))},onCancelRedirectTo:"/dictionaries"}))}});var N=Object(i.b)(e=>({dicts:e.config.Dicts}))(class extends n.a.Component{render(){const{value:e,dicts:t,onChange:a}=this.props;return n.a.createElement("div",{class:"select"},n.a.createElement("select",{value:e,onChange:e=>a(parseInt(e.target.value))},n.a.createElement("option",{value:"-1"},"- Filter by Dictionary -"),t.map(e=>n.a.createElement("option",{value:e.ID},e.Title))))}});const y=e=>v(`/admin/api/tasks${b(e)}`,{actionPrefix:"TASKS/LIST/FETCH",errorMessagePrefix:"Failed to fetch Tasks list"});var O=Object(i.b)(e=>({}),e=>Object(c.b)({fetchList:y},e))(class extends n.a.Component{constructor(e){super(e),this.state={tasks:null}}componentWillMount(){this.props.fetchList({}).then(f(e=>this.setState({tasks:e.Data})))}render(){if(!this.state.tasks)return null;const{value:e,onChange:t}=this.props,a=this.state.tasks;return n.a.createElement("div",{class:"select"},n.a.createElement("select",{value:e,onChange:e=>t(parseInt(e.target.value))},n.a.createElement("option",{value:"-1"},"- Filter by Task -"),a.map(e=>n.a.createElement("option",{value:e.ID},e.Title))))}});const x=e=>v(`/admin/api/articles${b(e)}`,{actionPrefix:"ARTICLES/LIST/FETCH",errorMessagePrefix:"Failed to fetch Articles list"}),L=()=>({type:"ARTICLES/LIST/LEAVE"}),k=({formData:e})=>v("/admin/api/articles",{options:{method:"post",body:JSON.stringify(e)},actionPrefix:"ARTICLES/RECORD/CREATE",errorMessagePrefix:"Failed to create article",successMessage:"Article has been created"}),w=()=>({type:"ARTICLES/RECORD/LEAVE"}),R=e=>v(`/admin/api/articles/${e}`,{actionPrefix:"ARTICLES/RECORD/FETCH",errorMessagePrefix:"Failed to fetch article"}),A=({formData:e})=>v("/admin/api/articles",{options:{method:"post",body:JSON.stringify(e)},actionPrefix:"ARTICLES/RECORD/UPDATE",errorMessagePrefix:"Failed to update article",successMessage:"Article has been updated"});var j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};var P=Object(i.b)(e=>({data:e.articles.list}),e=>Object(c.b)({fetchList:x,leaveList:L},e))(class extends n.a.Component{constructor(e){super(e),this.state=j({},this.getDefaultState(),JSON.parse(localStorage.getItem("articles.list-page-state")||"{}"))}setState(e,t){return super.setState(e,()=>{localStorage.setItem("articles.list-page-state",JSON.stringify(this.state)),t()})}componentWillMount(){this.fetchList()}componentWillUnmount(){this.props.leaveList()}fetchList(){this.props.fetchList({offset:this.state.offset,limit:this.state.limit,filter$DictID:this.state.filter$DictID,filter$TitlePrefix:this.state.filter$TitlePrefix,filter$TaskID:this.state.filter$TaskID,_defaults:this.getDefaultState()})}getDefaultState(){return{offset:0,limit:20,filter$DictID:-1,filter$TitlePrefix:"",filter$TaskID:-1}}setFilterState(e){this.setState(j({},e,{offset:0}),()=>{this.fetchList()})}render(){const{url:e}=this.props.match;return n.a.createElement("div",null,n.a.createElement("div",{className:"level"},n.a.createElement("div",{className:"level-left"},n.a.createElement("h1",{className:"level-item title"},"Articles")),n.a.createElement("div",{className:"level-right"},n.a.createElement("div",{className:"field is-grouped level-item"},n.a.createElement("p",{class:"control"},n.a.createElement(d.b,{to:`${e}/new`,className:"button is-link"},"New Article"))))),n.a.createElement("hr",null),n.a.createElement("div",{class:"field is-grouped"},n.a.createElement("p",{class:"control"},n.a.createElement("input",{class:"input",type:"text",value:this.state.filter$TitlePrefix,onChange:e=>this.setFilterState({filter$TitlePrefix:e.target.value})})),n.a.createElement("p",{class:"control"},n.a.createElement(N,{value:this.state.filter$DictID,onChange:e=>this.setFilterState({filter$DictID:e})})),n.a.createElement("p",{class:"control"},n.a.createElement(O,{value:this.state.filter$TaskID,onChange:e=>this.setFilterState({filter$TaskID:e})}))),this.props.data&&n.a.createElement("div",null,n.a.createElement("table",{className:"table is-hoverable is-fullwidth"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{width:"1px"},"ID"),n.a.createElement("th",null,"Title"),n.a.createElement("th",{width:"1px"}))),n.a.createElement("tbody",null,this.props.data.map(t=>n.a.createElement("tr",null,n.a.createElement("td",null,t.ID),n.a.createElement("td",null,t.Title),n.a.createElement("td",null,n.a.createElement(d.b,{to:`${e}/${t.ID}/edit`,className:"button"},"Edit"))))))),n.a.createElement("nav",{class:"pagination",role:"navigation","aria-label":"pagination"},n.a.createElement("a",{class:"pagination-previous",onClick:()=>{const e=Math.max(0,this.state.offset-this.state.limit);this.setState({offset:e},()=>{this.fetchList()})}},"Previous"),n.a.createElement("a",{class:"pagination-next",onClick:()=>{const e=this.state.offset+this.state.limit;this.setState({offset:e},()=>{this.fetchList()})}},"Next page")))}}),$=a("6/sb"),M=a.n($),F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};class H extends n.a.Component{shouldComponentUpdate(e,t){return e.value!=this.simplemde.value()}setElement(e){this.element=e,e?(this.simplemde=this.newSimpleMDE(e),this.simplemde.codemirror.on("change",()=>{this.props.onChange({target:{name:this.props.name,value:this.simplemde.value()}})})):(this.simplemde.toTextArea(),this.simplemde=null)}render(){return n.a.createElement("textarea",F({},this.props,{ref:e=>{this.setElement(e)}}))}newSimpleMDE(e){const t=new M.a({element:e,autofocus:!0,spellChecker:!1,autoDownloadFontAwesome:!1,toolbar:[{name:"bold",action:M.a.toggleBold,title:"Bold",className:"fas fa-bold"},{name:"italic",action:M.a.toggleItalic,title:"Italic",className:"fa fa-italic"},{name:"strikethrough",action:M.a.toggleStrikethrough,title:"Strikethrough",className:"fa fa-strikethrough"},{name:"quote",action:M.a.toggleBlockquote,title:"Quote",className:"fa fa-quote-left"},"|",{name:"unordered-list",action:M.a.toggleUnorderedList,title:"Generic List",className:"fa fa-list-ul"},{name:"ordered-list",action:M.a.toggleOrderedList,title:"Numbered List",className:"fa fa-list-ol"},"|",{name:"headword",action:({codemirror:e})=>{this.headwordAction(e)},title:"Headword",className:"fas fa-heading color-tag"}]});return t.codemirror.addKeyMap({"Shift-Alt-W":this.headwordAction,"Cmd-S":this.props.onSave},!0),t}headwordAction(e){const t=e.getSelection();e.replaceSelection(`<v-hw>${t}</v-hw>`,"around"),e.focus()}}class U extends n.a.Component{constructor(e){super(e),this.keyUpHandler=this.keyUpHandler.bind(this)}componentWillMount(){document.addEventListener("keyup",this.keyUpHandler)}componentWillUnmount(){document.removeEventListener("keyup",this.keyUpHandler)}keyUpHandler(e){const{index:t,onToggle:a}=this.props;e.ctrlKey&&e.keyCode-48==t&&(e.preventDefault(),e.stopPropagation(),a())}render(){const{onToggle:e,task:t,index:a}=this.props,s="PENDING"==t.Status?"is-info":"is-success";return n.a.createElement("div",null,n.a.createElement("a",{class:`button ${s}`,onClick:e},"(",a,") ",t.Task.Title))}}var W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};var G=Object(i.b)(e=>({dicts:e.config.Dicts}))(class extends n.a.Component{constructor(e){super(e),this.state=e.formData,this.handleInputChange=this.handleInputChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.toggleTask=this.toggleTask.bind(this)}handleInputChange(e){const t=e.target;let a="checkbox"===t.type?t.checked:t.value;const s=t.name;switch(s){case"DictID":a=parseInt(a)}this.setState({[s]:a})}toggleTask(e){let t=this.state.Tasks[e];t=W({},t,{Status:"PENDING"==t.Status?"DONE":"PENDING"});const a=[...this.state.Tasks];a[e]=t,this.setState({Tasks:a})}handleSubmit(e){e.preventDefault(),this.props.onSave({formData:this.state})}render(){return n.a.createElement("form",{onSubmit:this.handleSubmit},n.a.createElement("div",{class:"columns"},n.a.createElement("div",{class:"column"},n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"Dictionary"),n.a.createElement("div",{class:"control"},n.a.createElement("div",{class:"select"},n.a.createElement("select",{name:"DictID",value:this.state.DictID,onChange:this.handleInputChange,required:!0},n.a.createElement("option",null),this.props.dicts.map(e=>n.a.createElement("option",{value:e.ID},e.Title))))))),n.a.createElement("div",{class:"column"},n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"Tasks"),this.state.Tasks.map((e,t)=>n.a.createElement(U,{onToggle:()=>{this.toggleTask(t)},task:e,index:t+1}))))),n.a.createElement("div",{className:"field"},n.a.createElement("div",{className:"control"},n.a.createElement("label",{class:"label"},"Content"),n.a.createElement(H,{className:"textarea",type:"text",name:"Content",rows:"15",value:this.state.Content,onChange:this.handleInputChange,onSave:()=>{this.submitButton.click()}}))),n.a.createElement("div",{className:"field is-grouped"},n.a.createElement("p",{class:"control"},n.a.createElement("button",{className:"button is-link",type:"submit",ref:e=>this.submitButton=e},"Save")),n.a.createElement("p",{class:"control"},n.a.createElement(d.b,{className:"button",to:this.props.onCancelRedirectTo},"Cancel"))))}});var B=Object(i.b)(e=>{},e=>Object(c.b)({createRecord:k},e))(class extends n.a.Component{render(){return n.a.createElement("div",null,n.a.createElement("h1",{className:"title"},"Create New Article"),n.a.createElement(G,{formData:{},onSave:e=>{this.props.createRecord(e).then(f(e=>this.props.history.push("/articles")))},onCancelRedirectTo:"/articles"}))}});var J=Object(i.b)(e=>({data:e.articles.record.data}),e=>Object(c.b)({fetchRecord:R,leaveRecord:w,updateRecord:A},e))(class extends n.a.Component{componentWillMount(){this.props.fetchRecord(this.props.match.params.articleID)}componentWillUnmount(){this.props.leaveRecord()}render(){return this.props.data?n.a.createElement("div",null,n.a.createElement("h1",{className:"title"},"Edit #",this.props.data.ID," `",this.props.data.Title,"`"),n.a.createElement(G,{formData:this.props.data,onSave:e=>{this.props.updateRecord(e)},onCancelRedirectTo:"/articles"})):null}});var V=Object(i.b)(e=>({messages:e.messages}))(class extends n.a.Component{render(){return n.a.createElement("div",{className:"messages"},this.props.messages.map(e=>n.a.createElement("div",{key:e.id,className:`notification is-${e.level}`},e.message)))}});var _=(e=[],t)=>{switch(t.type){case"MESSAGES/SHOW":return[...e,{id:t.message.id,level:t.message.level,message:t.message.message}];case"MESSAGES/DISMISS":return e.filter(e=>e.id!==t.message.id);default:return e}};var q=Object(c.c)({list:(e=null,t)=>{switch(t.type){case"DICTIONARIES/LIST/FETCH/FULFILLED":return t.Data;case"DICTIONARIES/LIST/LEAVE":return null;default:return e}}}),K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};var z=Object(c.c)({list:(e=null,t)=>{switch(t.type){case"ARTICLES/LIST/FETCH/FULFILLED":return t.Data;case"ARTICLES/LIST/LEAVE":return null;default:return e}},record:(e={},t)=>{switch(t.type){case"ARTICLES/RECORD/FETCH/FULFILLED":return K({},e,{data:t.Data});case"ARTICLES/RECORD/LEAVE":return{};default:return e}}});const Q=Object(c.c)({user:(e={})=>e,config:(e={})=>e,messages:_,dictionaries:q,articles:z}),X=Object(c.d)(Q,window.verbumInitData,Object(c.a)(m.a));l.a.render(n.a.createElement(i.a,{store:X},n.a.createElement(d.a,{basename:"/admin"},n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement(p,null),n.a.createElement(V,null)),n.a.createElement("section",{className:"section"},n.a.createElement(d.d,null,n.a.createElement(d.c,{exact:!0,path:"/",component:class extends n.a.Component{render(){return n.a.createElement("div",null,"Verbum Admin Home Page")}}}),n.a.createElement(d.c,{path:"/dictionaries",component:class extends n.a.Component{render(){const{path:e}=this.props.match;return n.a.createElement("div",{className:"container is-fluid"},n.a.createElement(d.d,null,n.a.createElement(d.c,{exact:!0,path:e,component:I}),n.a.createElement(d.c,{path:`${e}/new`,component:T})))}}}),n.a.createElement(d.c,{path:"/articles",component:class extends n.a.Component{render(){const{path:e}=this.props.match;return n.a.createElement("div",{className:"container is-fluid"},n.a.createElement(d.d,null,n.a.createElement(d.c,{exact:!0,path:e,component:P}),n.a.createElement(d.c,{path:`${e}/new`,component:B}),n.a.createElement(d.c,{path:`${e}/:articleID/edit`,component:J})))}}})))))),document.getElementById("root"))}});
//# sourceMappingURL=admin.bundle.js.map