!function(e){function t(t){for(var n,l,i=t[0],o=t[1],c=t[2],p=0,h=[];p<i.length;p++)l=i[p],s[l]&&h.push(s[l][0]),s[l]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(m&&m(t);h.length;)h.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,i=1;i<a.length;i++){var o=a[i];0!==s[o]&&(n=!1)}n&&(r.splice(t--,1),e=l(l.s=a[0]))}return e}var n={},s={1:0},r=[];function l(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=e,l.c=n,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},l.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var i=window.webpackJsonp=window.webpackJsonp||[],o=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var m=o;r.push(["DT9B",0]),a()}({0:function(e,t){},"4aOD":function(e,t,a){(e.exports=a("I1BE")(!1)).push([e.i,".messages .alert { border-radius: 0; margin-bottom: 0; }\n",""])},DT9B:function(e,t,a){"use strict";a.r(t);a("SYky"),a("q4sD");var n=a("q1tI"),s=a.n(n),r=a("i8i4"),l=a.n(r),i=a("/MKj"),o=a("fvjX"),c=a("TdMD"),m=a.n(c),p=a("eO8H");const h=({path:e,children:t})=>s.a.createElement(p.c,{path:e,children:({match:a})=>s.a.createElement("li",{className:`nav-item ${a?"active":""}`},s.a.createElement(p.b,{className:"nav-link",to:e},t))});var d=Object(p.e)(Object(i.b)(e=>({user:e.user}))(class extends s.a.Component{render(){return s.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-dark bg-warning"},s.a.createElement(p.b,{className:"navbar-brand mb-0 h1",to:"/"},"Verbum"),s.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},s.a.createElement("span",{className:"navbar-toggler-icon"})),s.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},s.a.createElement("ul",{className:"navbar-nav mr-auto"},s.a.createElement(h,{path:"/dictionaries"},"Dictionaries"),s.a.createElement(h,{path:"/articles"},"Articles")),s.a.createElement("span",{className:"navbar-text"},this.props.user.name)))}}));const u=(e,t="info")=>a=>{const n=Date.now();a({type:"MESSAGES/SHOW",message:{id:n,message:e,level:t}}),setTimeout(()=>{a({type:"MESSAGES/DISMISS",message:{id:n}})},1e3)};var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};const E=e=>t=>!!t&&e(t),g=(e,{options:t,actionPrefix:a,errorMessagePrefix:n,successMessage:s})=>r=>(r({type:`${a}/PENDING`}),fetch(e,f({},t,{credentials:"include"})).then(e=>new Promise((t,a)=>{e.ok?e.json().then(e=>t(e)).catch(()=>t({data:{}})):e.text().then(t=>{a(new Error(t||e.statusText))})})).then(e=>(r(f({type:`${a}/FULFILLED`},e)),s&&r((e=>u(e,"success"))(s)),e)).catch(e=>(r({type:`${a}/REJECT`}),n&&r((e=>u(e,"danger"))(`${n}: ${e.message}`)),console.error(e),!1))),b=e=>{const t=new URLSearchParams,a=e._defaults||{};delete e._defaults;for(let n of Object.keys(e))n in a&&a[n]===e[n]||t.set(n,e[n]);let n=t.toString();return n.length>0&&(n=`?${n}`),n},v=()=>g("/admin/api/dictionaries",{actionPrefix:"DICTIONARIES/LIST/FETCH",errorMessagePrefix:"Failed to fetch Dictionaries list"}),S=()=>({type:"DICTIONARIES/LIST/LEAVE"}),D=({formData:e})=>g("/admin/api/dictionaries",{options:{method:"post",body:JSON.stringify(e)},actionPrefix:"DICTIONARIES/DICTIONARY/CREATE",errorMessagePrefix:"Failed to create the dictionary",successMessage:"Dictionary has been created successfully"});var C=Object(i.b)(e=>({data:e.dictionaries.list}),e=>Object(o.b)({fetchList:v,leaveList:S},e))(class extends s.a.Component{componentWillMount(){this.props.fetchList()}componentWillUnmount(){this.props.leaveList()}render(){const{url:e}=this.props.match;return s.a.createElement("div",{className:"mt-2"},s.a.createElement("h1",{className:"d-inline-block mr-2 align-middle"},"Dictionaries"),s.a.createElement(p.b,{to:`${e}/new`,className:"btn btn-light align-middle"},"New Dictionary"),this.props.data&&s.a.createElement("table",{className:"table"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"Title"))),s.a.createElement("tbody",null,this.props.data.map(e=>s.a.createElement("tr",null,s.a.createElement("td",null,e.Title))))))}});class I extends s.a.Component{constructor(e){super(e),this.state=e.formData,this.handleInputChange=this.handleInputChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleInputChange(e){const t=e.target;let a="checkbox"===t.type?t.checked:t.value;const n=t.name;this.setState({[n]:a})}handleSubmit(e){e.preventDefault(),this.props.onSave({formData:this.state})}render(){return s.a.createElement("form",{onSubmit:this.handleSubmit},s.a.createElement("div",{class:"form-group"},s.a.createElement("label",null,"Title"),s.a.createElement("input",{className:"form-control",type:"text",name:"Title",value:this.state.Title,onChange:this.handleInputChange,required:!0})),s.a.createElement("div",{className:"form-row"},s.a.createElement("button",{className:"btn btn-primary",type:"submit"},"Save"),s.a.createElement(p.b,{className:"btn",to:this.props.onCancelRedirectTo},"Cancel")))}}var T=Object(i.b)(e=>{},e=>Object(o.b)({createDictionary:D},e))(class extends s.a.Component{render(){return s.a.createElement("div",null,s.a.createElement("h1",{className:"mt-2"},"Create New Dictionary"),s.a.createElement(I,{formData:{},onSave:e=>{this.props.createDictionary(e).then(E(e=>this.props.history.push("/dictionaries")))},onCancelRedirectTo:"/dictionaries"}))}});var y=Object(i.b)(e=>({dicts:e.config.Dicts}))(class extends s.a.Component{render(){const{value:e,dicts:t,onChange:a}=this.props;return s.a.createElement("select",{className:"form-control",value:e,onChange:e=>a(parseInt(e.target.value))},s.a.createElement("option",{value:"-1"},"- Filter by Dictionary -"),t.map(e=>s.a.createElement("option",{value:e.ID},e.Title)))}});const N=e=>g(`/admin/api/tasks${b(e)}`,{actionPrefix:"TASKS/LIST/FETCH",errorMessagePrefix:"Failed to fetch Tasks list"});var x=Object(i.b)(e=>({}),e=>Object(o.b)({fetchList:N},e))(class extends s.a.Component{constructor(e){super(e),this.state={tasks:null}}componentWillMount(){this.props.fetchList({}).then(E(e=>this.setState({tasks:e.Data})))}render(){if(!this.state.tasks)return null;const{value:e,onChange:t}=this.props,a=this.state.tasks;return s.a.createElement("select",{className:"form-control",value:e,onChange:e=>t(parseInt(e.target.value))},s.a.createElement("option",{value:"-1"},"- Filter by Task -"),a.map(e=>s.a.createElement("option",{value:e.ID},e.Title)))}});const O=e=>g(`/admin/api/articles${b(e)}`,{actionPrefix:"ARTICLES/LIST/FETCH",errorMessagePrefix:"Failed to fetch Articles list"}),k=()=>({type:"ARTICLES/LIST/LEAVE"}),L=({formData:e})=>g("/admin/api/articles",{options:{method:"post",body:JSON.stringify(e)},actionPrefix:"ARTICLES/RECORD/CREATE",errorMessagePrefix:"Failed to create article",successMessage:"Article has been created"}),w=()=>({type:"ARTICLES/RECORD/LEAVE"}),R=e=>g(`/admin/api/articles/${e}`,{actionPrefix:"ARTICLES/RECORD/FETCH",errorMessagePrefix:"Failed to fetch article"}),A=({formData:e})=>g("/admin/api/articles",{options:{method:"post",body:JSON.stringify(e)},actionPrefix:"ARTICLES/RECORD/UPDATE",errorMessagePrefix:"Failed to update article",successMessage:"Article has been updated"});var P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};var j=Object(i.b)(e=>({data:e.articles.list}),e=>Object(o.b)({fetchList:O,leaveList:k},e))(class extends s.a.Component{constructor(e){super(e),this.state=P({},this.getDefaultState(),JSON.parse(localStorage.getItem("articles.list-page-state")||"{}"))}setState(e,t){return super.setState(e,()=>{localStorage.setItem("articles.list-page-state",JSON.stringify(this.state)),t()})}componentWillMount(){this.fetchList()}componentWillUnmount(){this.props.leaveList()}fetchList(){this.props.fetchList({offset:this.state.offset,limit:this.state.limit,filter$DictID:this.state.filter$DictID,filter$TitlePrefix:this.state.filter$TitlePrefix,filter$TaskID:this.state.filter$TaskID,_defaults:this.getDefaultState()})}getDefaultState(){return{offset:0,limit:20,filter$DictID:-1,filter$TitlePrefix:"",filter$TaskID:-1}}setFilterState(e){this.setState(P({},e,{offset:0}),()=>{this.fetchList()})}render(){const{url:e}=this.props.match;return s.a.createElement("div",{className:"container mt-2"},s.a.createElement("h1",{className:"d-inline-block mr-2 align-middle"},"Articles"),s.a.createElement(p.b,{to:`${e}/new`,className:"btn btn-light align-middle"},"New Article"),s.a.createElement("form",{class:"form-inline"},s.a.createElement("div",{class:"form-group mr-2 mb-3"},s.a.createElement("input",{class:"form-control",type:"text",value:this.state.filter$TitlePrefix,onChange:e=>this.setFilterState({filter$TitlePrefix:e.target.value}),placeholder:"Prefix"})),s.a.createElement("div",{class:"form-group mr-2 mb-3"},s.a.createElement(y,{value:this.state.filter$DictID,onChange:e=>this.setFilterState({filter$DictID:e})})),s.a.createElement("div",{class:"form-group mb-3"},s.a.createElement(x,{value:this.state.filter$TaskID,onChange:e=>this.setFilterState({filter$TaskID:e})}))),this.props.data&&s.a.createElement("div",null,s.a.createElement("table",{className:"table"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",{width:"1px"},"ID"),s.a.createElement("th",null,"Title"),s.a.createElement("th",{width:"1px"}))),s.a.createElement("tbody",null,this.props.data.map(t=>s.a.createElement("tr",null,s.a.createElement("td",null,t.ID),s.a.createElement("td",null,t.Title),s.a.createElement("td",null,s.a.createElement(p.b,{to:`${e}/${t.ID}/edit`,className:"btn"},"Edit"))))))),s.a.createElement("nav",null,s.a.createElement("ul",{className:"pagination justify-content-center"},s.a.createElement("li",{className:"page-item",onClick:()=>{const e=Math.max(0,this.state.offset-this.state.limit);this.setState({offset:e},()=>{this.fetchList()})}},s.a.createElement("a",{className:"page-link"},"Previous")),s.a.createElement("li",{className:"page-item",onClick:()=>{const e=this.state.offset+this.state.limit;this.setState({offset:e},()=>{this.fetchList()})}},s.a.createElement("a",{className:"page-link"},"Next page")))))}}),F=(a("w/kF"),a("6/sb")),M=a.n(F),$=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};class H extends s.a.Component{shouldComponentUpdate(e,t){return e.value!=this.simplemde.value()}setElement(e){this.element=e,e?(this.simplemde=this.newSimpleMDE(e),this.simplemde.codemirror.on("change",()=>{this.props.onChange({target:{name:this.props.name,value:this.simplemde.value()}})})):(this.simplemde.toTextArea(),this.simplemde=null)}render(){return s.a.createElement("textarea",$({},this.props,{ref:e=>{this.setElement(e)}}))}newSimpleMDE(e){const t=new M.a({element:e,autofocus:!0,spellChecker:!1,autoDownloadFontAwesome:!1,previewRender:function(e,t){return fetch("/admin/api/preview",{method:"post",credentials:"include",body:e}).then(e=>e.text()).then(e=>{t.innerHTML=e}),"Loading..."},toolbar:[{name:"bold",action:M.a.toggleBold,title:"Bold",className:"fas fa-bold"},{name:"italic",action:M.a.toggleItalic,title:"Italic",className:"fa fa-italic"},{name:"strikethrough",action:M.a.toggleStrikethrough,title:"Strikethrough",className:"fa fa-strikethrough"},{name:"quote",action:M.a.toggleBlockquote,title:"Quote",className:"fa fa-quote-left"},"|",{name:"unordered-list",action:M.a.toggleUnorderedList,title:"Generic List",className:"fa fa-list-ul"},{name:"ordered-list",action:M.a.toggleOrderedList,title:"Numbered List",className:"fa fa-list-ol"},"|",{name:"headword",action:({codemirror:e})=>{this.headwordAction(e)},title:"Headword",className:"fas fa-heading color-tag"},"|",{name:"preview",action:M.a.togglePreview,title:"Toggle Preview",noDisable:!0,className:"fas fa-eye"}]});return t.codemirror.addKeyMap({"Shift-Alt-W":this.headwordAction,"Cmd-S":this.props.onSave},!0),t}headwordAction(e){const t=e.getSelection();e.replaceSelection(`<v-hw>${t}</v-hw>`,"around"),e.focus()}}class U extends s.a.Component{constructor(e){super(e),this.keyUpHandler=this.keyUpHandler.bind(this)}componentWillMount(){document.addEventListener("keyup",this.keyUpHandler)}componentWillUnmount(){document.removeEventListener("keyup",this.keyUpHandler)}keyUpHandler(e){const{index:t,onToggle:a}=this.props;e.ctrlKey&&e.keyCode-48==t&&(e.preventDefault(),e.stopPropagation(),a())}render(){const{onToggle:e,task:t,index:a}=this.props,n="PENDING"==t.Status?"":"text-success";return s.a.createElement("div",null,s.a.createElement("input",{type:"checkbox",checked:"DONE"==t.Status,onClick:e})," ",s.a.createElement("span",{className:n,onClick:e,style:{cursor:"pointer"}},"(",a,") ",t.Task.Title))}}var W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};var B=Object(i.b)(e=>({dicts:e.config.Dicts}))(class extends s.a.Component{constructor(e){super(e),this.state=e.formData,this.handleInputChange=this.handleInputChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.toggleTask=this.toggleTask.bind(this)}handleInputChange(e){const t=e.target;let a="checkbox"===t.type?t.checked:t.value;const n=t.name;switch(n){case"DictID":a=parseInt(a)}this.setState({[n]:a})}toggleTask(e){let t=this.state.Tasks[e];t=W({},t,{Status:"PENDING"==t.Status?"DONE":"PENDING"});const a=[...this.state.Tasks];a[e]=t,this.setState({Tasks:a})}handleSubmit(e){e.preventDefault(),this.props.onSave({formData:this.state})}render(){return s.a.createElement("form",{onSubmit:this.handleSubmit},s.a.createElement("div",{class:"form-row"},s.a.createElement("div",{class:"form-group col-md-10"},s.a.createElement(H,{className:"textarea",type:"text",name:"Content",rows:"15",value:this.state.Content,onChange:this.handleInputChange,onSave:()=>{this.submitButton.click()}})),s.a.createElement("div",{class:"form-group col-md-2"},s.a.createElement("label",{class:"label"},"Tasks"),this.state.Tasks.map((e,t)=>s.a.createElement(U,{onToggle:()=>{this.toggleTask(t)},task:e,index:t+1})))),s.a.createElement("div",{class:"form-row"},s.a.createElement("button",{className:"btn btn-primary",type:"submit",ref:e=>this.submitButton=e},"Save"),s.a.createElement(p.b,{className:"btn btn-link",to:this.props.onCancelRedirectTo},"Cancel")))}});var G=Object(i.b)(e=>{},e=>Object(o.b)({createRecord:L},e))(class extends s.a.Component{render(){return s.a.createElement("div",{className:"container"},s.a.createElement("h1",{className:"mt-2"},"Create New Article"),s.a.createElement(B,{formData:{},onSave:e=>{this.props.createRecord(e).then(E(e=>this.props.history.push("/articles")))},onCancelRedirectTo:"/articles"}))}});var J=Object(i.b)(e=>({data:e.articles.record.data}),e=>Object(o.b)({fetchRecord:R,leaveRecord:w,updateRecord:A},e))(class extends s.a.Component{componentWillMount(){this.props.fetchRecord(this.props.match.params.articleID)}componentWillUnmount(){this.props.leaveRecord()}render(){return this.props.data?s.a.createElement("div",{class:"container-fluid pb-2"},s.a.createElement("h1",{className:"mt-2"},"Edit #",this.props.data.ID," `",this.props.data.Title,"`"),s.a.createElement(B,{formData:this.props.data,onSave:e=>{this.props.updateRecord(e)},onCancelRedirectTo:"/articles"})):null}});a("FrQl");var V=Object(i.b)(e=>({messages:e.messages}))(class extends s.a.Component{render(){return s.a.createElement("div",{className:"messages position-absolute w-100"},this.props.messages.map(e=>s.a.createElement("div",{key:e.id,className:`alert alert-${e.level}`},e.message)))}});var _=(e=[],t)=>{switch(t.type){case"MESSAGES/SHOW":return[...e,{id:t.message.id,level:t.message.level,message:t.message.message}];case"MESSAGES/DISMISS":return e.filter(e=>e.id!==t.message.id);default:return e}};var q=Object(o.c)({list:(e=null,t)=>{switch(t.type){case"DICTIONARIES/LIST/FETCH/FULFILLED":return t.Data;case"DICTIONARIES/LIST/LEAVE":return null;default:return e}}}),K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};var Q=Object(o.c)({list:(e=null,t)=>{switch(t.type){case"ARTICLES/LIST/FETCH/FULFILLED":return t.Data;case"ARTICLES/LIST/LEAVE":return null;default:return e}},record:(e={},t)=>{switch(t.type){case"ARTICLES/RECORD/FETCH/FULFILLED":return K({},e,{data:t.Data});case"ARTICLES/RECORD/LEAVE":return{};default:return e}}});const Y=Object(o.c)({user:(e={})=>e,config:(e={})=>e,messages:_,dictionaries:q,articles:Q}),X=Object(o.d)(Y,window.verbumInitData,Object(o.a)(m.a));l.a.render(s.a.createElement(i.a,{store:X},s.a.createElement(p.a,{basename:"/admin"},s.a.createElement("div",null,s.a.createElement("div",{className:"sticky-top"},s.a.createElement(d,null),s.a.createElement(V,null)),s.a.createElement("section",{className:"section"},s.a.createElement(p.d,null,s.a.createElement(p.c,{exact:!0,path:"/",component:class extends s.a.Component{render(){return s.a.createElement("div",null,"Verbum Admin Home Page")}}}),s.a.createElement(p.c,{path:"/dictionaries",component:class extends s.a.Component{render(){const{path:e}=this.props.match;return s.a.createElement("div",{className:"container"},s.a.createElement(p.d,null,s.a.createElement(p.c,{exact:!0,path:e,component:C}),s.a.createElement(p.c,{path:`${e}/new`,component:T})))}}}),s.a.createElement(p.c,{path:"/articles",component:class extends s.a.Component{render(){const{path:e}=this.props.match;return s.a.createElement(p.d,null,s.a.createElement(p.c,{exact:!0,path:e,component:j}),s.a.createElement(p.c,{path:`${e}/new`,component:G}),s.a.createElement(p.c,{path:`${e}/:articleID/edit`,component:J}))}}})))))),document.getElementById("root"))},FrQl:function(e,t,a){var n=a("4aOD");"string"==typeof n&&(n=[[e.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};a("aET+")(n,s);n.locals&&(e.exports=n.locals)},h6FE:function(e,t,a){(e.exports=a("I1BE")(!1)).push([e.i,".CodeMirror .CodeMirror-scroll { height: calc(100vh - 300px); }\n",""])},"w/kF":function(e,t,a){var n=a("h6FE");"string"==typeof n&&(n=[[e.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};a("aET+")(n,s);n.locals&&(e.exports=n.locals)}});
//# sourceMappingURL=admin.bundle.js.map