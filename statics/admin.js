!function(e){var t={};function a(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=7)}([function(e,t){e.exports=React},function(e,t){e.exports=ReactRouterDOM},function(e,t){e.exports=ReactRedux},function(e,t){e.exports=Redux},function(e,t){e.exports=SimpleMDE},function(e,t){e.exports=ReduxThunk},function(e,t){e.exports=ReactDOM},function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(6),l=a.n(r),i=a(2),c=a(3),o=a(5),m=a.n(o),d=a(1);const u=({path:e,children:t})=>n.a.createElement(d.Route,{path:e,children:({match:a})=>n.a.createElement(d.Link,{className:`navbar-item ${a?"is-active":""}`,to:e},t)});var h=Object(d.withRouter)(Object(i.connect)(e=>({user:e.user}))(class extends n.a.Component{render(){return n.a.createElement("nav",{className:"navbar is-link"},n.a.createElement("div",{className:"navbar-brand"},n.a.createElement(d.Link,{className:"navbar-item has-text-weight-bold is-size-4",to:"/"},"Verbum")),n.a.createElement("div",{className:"navbar-menu"},n.a.createElement("div",{className:"navbar-start"},n.a.createElement(u,{path:"/dictionaries"},"Dictionaries"),n.a.createElement(u,{path:"/articles"},"Articles")),n.a.createElement("div",{className:"navbar-end"},n.a.createElement("div",{className:"navbar-item"},this.props.user.name))))}}));const p=(e,t="info")=>a=>{const s=Date.now();a({type:"MESSAGES/SHOW",message:{id:s,message:e,level:t}}),setTimeout(()=>{a({type:"MESSAGES/DISMISS",message:{id:s}})},5e3)};var E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};const f=e=>t=>!!t&&e(t),v=(e,{options:t,actionPrefix:a,errorMessagePrefix:s,successMessage:n})=>r=>(r({type:`${a}/PENDING`}),fetch(e,E({},t,{credentials:"include"})).then(e=>new Promise((t,a)=>{e.ok?e.json().then(e=>t(e)).catch(()=>t({data:{}})):e.text().then(t=>{a(new Error(t||e.statusText))})})).then(e=>(r(E({type:`${a}/FULFILLED`},e)),n&&r((e=>p(e,"success"))(n)),e)).catch(e=>(r({type:`${a}/REJECT`}),s&&r((e=>p(e,"danger"))(`${s}: ${e.message}`)),console.error(e),!1))),g=e=>{const t=new URLSearchParams,a=e._defaults||{};delete e._defaults;for(let s of Object.keys(e))s in a&&a[s]===e[s]||t.set(s,e[s]);let s=t.toString();return s.length>0&&(s=`?${s}`),s},b=()=>v("/admin/api/dictionaries",{actionPrefix:"DICTIONARIES/LIST/FETCH",errorMessagePrefix:"Failed to fetch Dictionaries list"}),S=()=>({type:"DICTIONARIES/LIST/LEAVE"}),D=({formData:e})=>v("/admin/api/dictionaries",{options:{method:"post",body:JSON.stringify(e)},actionPrefix:"DICTIONARIES/DICTIONARY/CREATE",errorMessagePrefix:"Failed to create the dictionary",successMessage:"Dictionary has been created successfully"});var C=Object(i.connect)(e=>({data:e.dictionaries.list}),e=>Object(c.bindActionCreators)({fetchList:b,leaveList:S},e))(class extends n.a.Component{componentWillMount(){this.props.fetchList()}componentWillUnmount(){this.props.leaveList()}render(){const{url:e}=this.props.match;return n.a.createElement("div",null,n.a.createElement("div",{className:"level"},n.a.createElement("div",{className:"level-left"},n.a.createElement("h1",{className:"level-item title"},"Dictionaries")),n.a.createElement("div",{className:"level-right"},n.a.createElement("div",{className:"field is-grouped level-item"},n.a.createElement("p",{class:"control"},n.a.createElement(d.Link,{to:`${e}/new`,className:"button is-link"},"New Dictionary"))))),n.a.createElement("hr",null),this.props.data&&n.a.createElement("table",{className:"table is-hoverable is-fullwidth"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Title"))),n.a.createElement("tbody",null,this.props.data.map(e=>n.a.createElement("tr",null,n.a.createElement("td",null,e.Title))))))}});class I extends n.a.Component{constructor(e){super(e),this.state=e.formData,this.handleInputChange=this.handleInputChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleInputChange(e){const t=e.target;let a="checkbox"===t.type?t.checked:t.value;const s=t.name;this.setState({[s]:a})}handleSubmit(e){e.preventDefault(),this.props.onSave({formData:this.state})}render(){return n.a.createElement("form",{onSubmit:this.handleSubmit},n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"Title"),n.a.createElement("div",{class:"control"},n.a.createElement("input",{className:"input",type:"text",name:"Title",value:this.state.Title,onChange:this.handleInputChange,required:!0}))),n.a.createElement("div",{className:"field is-grouped"},n.a.createElement("p",{class:"control"},n.a.createElement("button",{className:"button is-link",type:"submit"},"Save")),n.a.createElement("p",{class:"control"},n.a.createElement(d.Link,{className:"button",to:this.props.onCancelRedirectTo},"Cancel"))))}}var T=Object(i.connect)(e=>{},e=>Object(c.bindActionCreators)({createDictionary:D},e))(class extends n.a.Component{render(){return n.a.createElement("div",null,n.a.createElement("h1",{className:"title"},"Create New Dictionary"),n.a.createElement(I,{formData:{},onSave:e=>{this.props.createDictionary(e).then(f(e=>this.props.history.push("/dictionaries")))},onCancelRedirectTo:"/dictionaries"}))}});var N=Object(i.connect)(e=>({dicts:e.config.Dicts}))(class extends n.a.Component{render(){const{value:e,dicts:t,onChange:a}=this.props;return n.a.createElement("div",{class:"select"},n.a.createElement("select",{value:e,onChange:e=>a(parseInt(e.target.value))},n.a.createElement("option",{value:"-1"},"- Filter by Dictionary -"),t.map(e=>n.a.createElement("option",{value:e.ID},e.Title))))}});const x=e=>v(`/admin/api/tasks${g(e)}`,{actionPrefix:"TASKS/LIST/FETCH",errorMessagePrefix:"Failed to fetch Tasks list"});var y=Object(i.connect)(e=>({}),e=>Object(c.bindActionCreators)({fetchList:x},e))(class extends n.a.Component{constructor(e){super(e),this.state={tasks:null}}componentWillMount(){this.props.fetchList({}).then(f(e=>this.setState({tasks:e.Data})))}render(){if(!this.state.tasks)return null;const{value:e,onChange:t}=this.props,a=this.state.tasks;return n.a.createElement("div",{class:"select"},n.a.createElement("select",{value:e,onChange:e=>t(parseInt(e.target.value))},n.a.createElement("option",{value:"-1"},"- Filter by Task -"),a.map(e=>n.a.createElement("option",{value:e.ID},e.Title))))}});const R=e=>v(`/admin/api/articles${g(e)}`,{actionPrefix:"ARTICLES/LIST/FETCH",errorMessagePrefix:"Failed to fetch Articles list"}),L=()=>({type:"ARTICLES/LIST/LEAVE"}),O=({formData:e})=>v("/admin/api/articles",{options:{method:"post",body:JSON.stringify(e)},actionPrefix:"ARTICLES/RECORD/CREATE",errorMessagePrefix:"Failed to create article",successMessage:"Article has been created"}),k=()=>({type:"ARTICLES/RECORD/LEAVE"}),A=e=>v(`/admin/api/articles/${e}`,{actionPrefix:"ARTICLES/RECORD/FETCH",errorMessagePrefix:"Failed to fetch article"}),w=({formData:e})=>v("/admin/api/articles",{options:{method:"post",body:JSON.stringify(e)},actionPrefix:"ARTICLES/RECORD/UPDATE",errorMessagePrefix:"Failed to update article",successMessage:"Article has been updated"});var P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};var j=Object(i.connect)(e=>({data:e.articles.list}),e=>Object(c.bindActionCreators)({fetchList:R,leaveList:L},e))(class extends n.a.Component{constructor(e){super(e),this.state=P({},this.getDefaultState(),JSON.parse(localStorage.getItem("articles.list-page-state")||"{}"))}setState(e,t){return super.setState(e,()=>{localStorage.setItem("articles.list-page-state",JSON.stringify(this.state)),t()})}componentWillMount(){this.fetchList()}componentWillUnmount(){this.props.leaveList()}fetchList(){this.props.fetchList({offset:this.state.offset,limit:this.state.limit,filter$DictID:this.state.filter$DictID,filter$TitlePrefix:this.state.filter$TitlePrefix,filter$TaskID:this.state.filter$TaskID,_defaults:this.getDefaultState()})}getDefaultState(){return{offset:0,limit:20,filter$DictID:-1,filter$TitlePrefix:"",filter$TaskID:-1}}setFilterState(e){this.setState(P({},e,{offset:0}),()=>{this.fetchList()})}render(){const{url:e}=this.props.match;return n.a.createElement("div",null,n.a.createElement("div",{className:"level"},n.a.createElement("div",{className:"level-left"},n.a.createElement("h1",{className:"level-item title"},"Articles")),n.a.createElement("div",{className:"level-right"},n.a.createElement("div",{className:"field is-grouped level-item"},n.a.createElement("p",{class:"control"},n.a.createElement(d.Link,{to:`${e}/new`,className:"button is-link"},"New Article"))))),n.a.createElement("hr",null),n.a.createElement("div",{class:"field is-grouped"},n.a.createElement("p",{class:"control"},n.a.createElement("input",{class:"input",type:"text",value:this.state.filter$TitlePrefix,onChange:e=>this.setFilterState({filter$TitlePrefix:e.target.value})})),n.a.createElement("p",{class:"control"},n.a.createElement(N,{value:this.state.filter$DictID,onChange:e=>this.setFilterState({filter$DictID:e})})),n.a.createElement("p",{class:"control"},n.a.createElement(y,{value:this.state.filter$TaskID,onChange:e=>this.setFilterState({filter$TaskID:e})}))),this.props.data&&n.a.createElement("div",null,n.a.createElement("table",{className:"table is-hoverable is-fullwidth"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{width:"1px"},"ID"),n.a.createElement("th",null,"Title"),n.a.createElement("th",{width:"1px"}))),n.a.createElement("tbody",null,this.props.data.map(t=>n.a.createElement("tr",null,n.a.createElement("td",null,t.ID),n.a.createElement("td",null,t.Title),n.a.createElement("td",null,n.a.createElement(d.Link,{to:`${e}/${t.ID}/edit`,className:"button"},"Edit"))))))),n.a.createElement("nav",{class:"pagination",role:"navigation","aria-label":"pagination"},n.a.createElement("a",{class:"pagination-previous",onClick:()=>{const e=Math.max(0,this.state.offset-this.state.limit);this.setState({offset:e},()=>{this.fetchList()})}},"Previous"),n.a.createElement("a",{class:"pagination-next",onClick:()=>{const e=this.state.offset+this.state.limit;this.setState({offset:e},()=>{this.fetchList()})}},"Next page")))}}),$=a(4),M=a.n($),F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};class U extends n.a.Component{shouldComponentUpdate(e,t){return e.value!=this.simplemde.value()}setElement(e){this.element=e,e?(this.simplemde=this.newSimpleMDE(e),this.simplemde.codemirror.on("change",()=>{this.props.onChange({target:{name:this.props.name,value:this.simplemde.value()}})})):(this.simplemde.toTextArea(),this.simplemde=null)}render(){return n.a.createElement("textarea",F({},this.props,{ref:e=>{this.setElement(e)}}))}newSimpleMDE(e){const t=new M.a({element:e,autofocus:!0,spellChecker:!1,toolbar:[{name:"bold",action:M.a.toggleBold,title:"Bold",className:"fa fa-bold"},{name:"italic",action:M.a.toggleItalic,title:"Italic",className:"fa fa-italic"},{name:"strikethrough",action:M.a.toggleStrikethrough,title:"Strikethrough",className:"fa fa-strikethrough"},{name:"quote",action:M.a.toggleBlockquote,title:"Quote",className:"fa fa-quote-left"},"|",{name:"unordered-list",action:M.a.toggleUnorderedList,title:"Generic List",className:"fa fa-list-ul"},{name:"ordered-list",action:M.a.toggleOrderedList,title:"Numbered List",className:"fa fa-list-ol"},"|",{name:"headword",action:({codemirror:e})=>{this.headwordAction(e)},title:"Headword",className:"fa fa-header color-tag"}]});return t.codemirror.addKeyMap({"Shift-Alt-W":this.headwordAction,"Cmd-S":this.props.onSave},!0),t}headwordAction(e){const t=e.getSelection();e.replaceSelection(`<v-hw>${t}</v-hw>`,"around"),e.focus()}}class H extends n.a.Component{constructor(e){super(e),this.keyUpHandler=this.keyUpHandler.bind(this)}componentWillMount(){document.addEventListener("keyup",this.keyUpHandler)}componentWillUnmount(){document.removeEventListener("keyup",this.keyUpHandler)}keyUpHandler(e){const{index:t,onToggle:a}=this.props;e.ctrlKey&&e.keyCode-48==t&&(e.preventDefault(),e.stopPropagation(),a())}render(){const{onToggle:e,task:t,index:a}=this.props,s="PENDING"==t.Status?"is-info":"is-success",r="PENDING"==t.Status?n.a.createElement("i",{class:"fa fa-circle-o","aria-hidden":"true"}):n.a.createElement("i",{class:"fa fa-check-circle","aria-hidden":"true"});return n.a.createElement("div",null,n.a.createElement("a",{class:`button ${s}`,onClick:e},r," (",a,") ",t.Task.Title))}}var W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};var G=Object(i.connect)(e=>({dicts:e.config.Dicts}))(class extends n.a.Component{constructor(e){super(e),this.state=e.formData,this.handleInputChange=this.handleInputChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.toggleTask=this.toggleTask.bind(this)}handleInputChange(e){const t=e.target;let a="checkbox"===t.type?t.checked:t.value;const s=t.name;switch(s){case"DictID":a=parseInt(a)}this.setState({[s]:a})}toggleTask(e){let t=this.state.Tasks[e];t=W({},t,{Status:"PENDING"==t.Status?"DONE":"PENDING"});const a=[...this.state.Tasks];a[e]=t,this.setState({Tasks:a})}handleSubmit(e){e.preventDefault(),this.props.onSave({formData:this.state})}render(){return n.a.createElement("form",{onSubmit:this.handleSubmit},n.a.createElement("div",{class:"columns"},n.a.createElement("div",{class:"column"},n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"Dictionary"),n.a.createElement("div",{class:"control"},n.a.createElement("div",{class:"select"},n.a.createElement("select",{name:"DictID",value:this.state.DictID,onChange:this.handleInputChange,required:!0},n.a.createElement("option",null),this.props.dicts.map(e=>n.a.createElement("option",{value:e.ID},e.Title))))))),n.a.createElement("div",{class:"column"},n.a.createElement("div",{class:"field"},n.a.createElement("label",{class:"label"},"Tasks"),this.state.Tasks.map((e,t)=>n.a.createElement(H,{onToggle:()=>{this.toggleTask(t)},task:e,index:t+1}))))),n.a.createElement("div",{className:"field"},n.a.createElement("div",{className:"control"},n.a.createElement("label",{class:"label"},"Content"),n.a.createElement(U,{className:"textarea",type:"text",name:"Content",rows:"15",value:this.state.Content,onChange:this.handleInputChange,onSave:()=>{this.submitButton.click()}}))),n.a.createElement("div",{className:"field is-grouped"},n.a.createElement("p",{class:"control"},n.a.createElement("button",{className:"button is-link",type:"submit",ref:e=>this.submitButton=e},"Save")),n.a.createElement("p",{class:"control"},n.a.createElement(d.Link,{className:"button",to:this.props.onCancelRedirectTo},"Cancel"))))}});var V=Object(i.connect)(e=>{},e=>Object(c.bindActionCreators)({createRecord:O},e))(class extends n.a.Component{render(){return n.a.createElement("div",null,n.a.createElement("h1",{className:"title"},"Create New Article"),n.a.createElement(G,{formData:{},onSave:e=>{this.props.createRecord(e).then(f(e=>this.props.history.push("/articles")))},onCancelRedirectTo:"/articles"}))}});var B=Object(i.connect)(e=>({data:e.articles.record.data}),e=>Object(c.bindActionCreators)({fetchRecord:A,leaveRecord:k,updateRecord:w},e))(class extends n.a.Component{componentWillMount(){this.props.fetchRecord(this.props.match.params.articleID)}componentWillUnmount(){this.props.leaveRecord()}render(){return this.props.data?n.a.createElement("div",null,n.a.createElement("h1",{className:"title"},"Edit #",this.props.data.ID," `",this.props.data.Title,"`"),n.a.createElement(G,{formData:this.props.data,onSave:e=>{this.props.updateRecord(e)},onCancelRedirectTo:"/articles"})):null}});var _=Object(i.connect)(e=>({messages:e.messages}))(class extends n.a.Component{render(){return n.a.createElement("div",{className:"messages"},this.props.messages.map(e=>n.a.createElement("div",{key:e.id,className:`notification is-${e.level}`},e.message)))}});var J=(e=[],t)=>{switch(t.type){case"MESSAGES/SHOW":return[...e,{id:t.message.id,level:t.message.level,message:t.message.message}];case"MESSAGES/DISMISS":return e.filter(e=>e.id!==t.message.id);default:return e}};var q=Object(c.combineReducers)({list:(e=null,t)=>{switch(t.type){case"DICTIONARIES/LIST/FETCH/FULFILLED":return t.Data;case"DICTIONARIES/LIST/LEAVE":return null;default:return e}}}),K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e};var z=Object(c.combineReducers)({list:(e=null,t)=>{switch(t.type){case"ARTICLES/LIST/FETCH/FULFILLED":return t.Data;case"ARTICLES/LIST/LEAVE":return null;default:return e}},record:(e={},t)=>{switch(t.type){case"ARTICLES/RECORD/FETCH/FULFILLED":return K({},e,{data:t.Data});case"ARTICLES/RECORD/LEAVE":return{};default:return e}}});const Q=Object(c.combineReducers)({user:(e={})=>e,config:(e={})=>e,messages:J,dictionaries:q,articles:z}),Y=Object(c.createStore)(Q,window.verbumInitData,Object(c.applyMiddleware)(m.a));l.a.render(n.a.createElement(i.Provider,{store:Y},n.a.createElement(d.BrowserRouter,{basename:"/admin"},n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement(h,null),n.a.createElement(_,null)),n.a.createElement("section",{className:"section"},n.a.createElement(d.Switch,null,n.a.createElement(d.Route,{exact:!0,path:"/",component:class extends n.a.Component{render(){return n.a.createElement("div",null,"Verbum Admin Home Page")}}}),n.a.createElement(d.Route,{path:"/dictionaries",component:class extends n.a.Component{render(){const{path:e}=this.props.match;return n.a.createElement("div",{className:"container is-fluid"},n.a.createElement(d.Switch,null,n.a.createElement(d.Route,{exact:!0,path:e,component:C}),n.a.createElement(d.Route,{path:`${e}/new`,component:T})))}}}),n.a.createElement(d.Route,{path:"/articles",component:class extends n.a.Component{render(){const{path:e}=this.props.match;return n.a.createElement("div",{className:"container is-fluid"},n.a.createElement(d.Switch,null,n.a.createElement(d.Route,{exact:!0,path:e,component:j}),n.a.createElement(d.Route,{path:`${e}/new`,component:V}),n.a.createElement(d.Route,{path:`${e}/:articleID/edit`,component:B})))}}})))))),document.getElementById("root"))}]);